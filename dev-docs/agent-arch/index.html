<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Agent Architecture - GRACC Documentation</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">


    <link href="../../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">GRACC Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Introduction</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development Docs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li class="active">
    <a href="./">Agent Architecture</a>
</li>

                        
                            
<li >
    <a href="../message-queues/">Message Queues</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../message-queues/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/opensciencegrid/gracc">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#agent-architecture">Agent Architecture</a></li>
        
            <li class="second-level"><a href="#components">Components</a></li>
            
        
            <li class="second-level"><a href="#agents">Agents</a></li>
            
        
            <li class="second-level"><a href="#listener-agent">Listener Agent</a></li>
            
        
            <li class="second-level"><a href="#summary-agent">Summary Agent</a></li>
            
        
            <li class="second-level"><a href="#raw-agent">Raw Agent</a></li>
            
        
            <li class="second-level"><a href="#future-components">Future components</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="agent-architecture">Agent Architecture</h1>
<p>The agents that coordinate for GRACC</p>
<hr />
<p>Unlike its predecessor Gratia, GRACC is split into a number of agents that coordinate through a message queue.  The intent is that this separates the distinct components into separate modules that can evolve at independent rates.  Further, it provides a mechanism for external entities interested in accounting data to integrate into the system.</p>
<h2 id="components">Components</h2>
<p>The three major centralized components of GRACC include:</p>
<ul>
<li>Message queue: A <a href="https://www.rabbitmq.com/">RabbitMQ</a> service for exchanging messages between system components.  Utilized for its publish-subscribe model and its standardized wire format.</li>
<li><code>GRACC</code> - a centralized collector endpoint.  This is a HTTP-based service that listens for incoming records from remote probes, buffers them to disk, then sends them to the message queue.</li>
<li><code>GRACE</code> - an <a href="https://www.elastic.co/">ElasticSearch</a>-based data storage service.  Consists of an ElasticSearch database instance and several agents used to populate the system.</li>
</ul>
<p>Other pieces of the accounting infrastructure include the site probes (which produce the records) and planned web views of the accounting data (likely based on Grafana or Kibana).</p>
<p>We also plan on developing <code>gracc-replay</code>, a command-line tool for initializing replay of data in the system.  This is meant to:
<em> Upload Gratia raw record tarballs from disk to the message queue.
</em> Request raw data to be resent from a given <code>GRACE</code> instance to a message queue destination (likely a second <code>GRACE</code> instance).
* Request summary data to be recalculated from a given <code>GRACE</code> instance to a message queue destination.</p>
<h2 id="agents">Agents</h2>
<h2 id="listener-agent">Listener Agent</h2>
<p>A agent running on <code>GRACE</code>.  The listener agent listens for one-time data replication requests (for either raw or summary data) on the message queue and launches an appropriate sub-process to send the data to the requested destination.</p>
<p>It listens on the known queue <code>/gracc.&lt;db&gt;.requests</code> (as defined on <a href="../message-queues/">Message Queues</a>).  </p>
<h2 id="summary-agent">Summary Agent</h2>
<p>This agent has two responsibilities:
<em> Listening to a message queue (<code>/grace.&lt;db&gt;.summary</code>) for summary records.  It fetchs the records from the queue and uploads them into ElasticSearch.
</em> Periodically request new summaries be made by the Listener agent.  We envision:
  * Every 15 minutes, we re-summarize the past 2 days of data.
  * Every 12 hours, we re-summarize the past 30 days of data.</p>
<p>This allows late raw records to be included in the summary information.</p>
<h2 id="raw-agent">Raw Agent</h2>
<p>An agent which listens to one or more message queues (typically, its own queue for replay information and one or more collector queues) for raw records.  Records are read off the queue and uploaded to the database.</p>
<h2 id="future-components">Future components</h2>
<p>Components that will likely be needed in the future include:
<em> <code>GRACE-B</code>: Listens for raw records and serializes them to disk; on a daily basis, compact them into a tarball and upload them to archival storage.
</em> <code>GRACE-D</code>: A <em>dead letter queue</em>: a destination for any unparseable or otherwise-rejected records.
* Some destination for status information.  Every 15 minutes, each component should generate a short status update (analogous to a HTCondor daemon's ClassAd in a <code>condor_collector</code>) and serialize it to a database.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Open Science Grid<br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
