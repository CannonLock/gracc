<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>GRACE Backup Documentation - GRACC Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "GRACE Backup Documentation";
    var mkdocs_page_input_path = "dev-docs/backups.md";
    var mkdocs_page_url = "/dev-docs/backups/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> GRACC Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user/standard/">Standard Interfaces</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/grafana/">Custom Grafana</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/direct/">Direct Queries</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../agent-arch/">Agent Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../message-queues/">Message Queues</a>
                </li>
                <li class="">
                    
    <a class="" href="../raw-records/">Raw Records</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Operator Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../install-grace-db/">GRACE Installation</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">GRACE Backup Documentation</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#backup-configuration">Backup Configuration</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#backup-sources">Backup Sources</a></li>
        
            <li><a class="toctree-l4" href="#backup-location">Backup Location</a></li>
        
            <li><a class="toctree-l4" href="#restore-operation">Restore Operation</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../ops/services/">GRACE Operations</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">GRACC Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Operator Docs &raquo;</li>
        
      
    
    <li>GRACE Backup Documentation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/gracc/edit/master/docs/dev-docs/backups.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="backup-configuration">Backup Configuration</h1>
<h2 id="backup-sources">Backup Sources</h2>
<p>GRACC backup sources come from listening and duplicating all raw records sent to the system through the RabbitMQ system.  The <a href="https://github.com/opensciencegrid/gracc-archive">GRACC Archiver</a> listens to the raw RabbitMQ exchanges.  It listens to both the <code>gracc.osg.raw</code> and the <code>gracc.osg-transfer.raw</code> exchanges.</p>
<p>The archive agent stores the records into a tar.gz file located in <code>/var/lib/graccarchive/sandbox</code>.  On new days (or agent crashes) the tar.gz files are atomically copied to <code>/var/lib/graccarchive/output</code>.  The transfer archiver similarily stores files in <code>/var/lib/graccarchive/sandbox-transfer</code> and <code>/var/lib/graccarchive/output-transfer</code>.</p>
<p>The archive agent is configured in <code>/etc/graccarchive/conf</code>.  It uses systemd template units to run both the raw jobs and raw transfer archivers at the same time.</p>
<h2 id="backup-location">Backup Location</h2>
<p>The backups are copied to FNAL by the <a href="https://github.com/opensciencegrid/gracc-backup">gracc-backup</a> tool.  This uses SystemD timer and service files to periodically copy the output <code>.tar.gz</code> files to FNAL.  The final destination (gsiftp) of the files is configured in the *.service files with the tool</p>
<h2 id="restore-operation">Restore Operation</h2>
<p>The restore operation uses the <code>graccunarchiver</code> tool distributed with the GRACC Archiver agent.  The workflow of a restore is:</p>
<ol>
<li>Copy the backup file from the backup location.  You will likely need to use <code>globus-url-copy</code> in order to copy the files back from the backup location.</li>
<li>
<p>Run the <code>graccunarchiver</code> tool from the GRACC Archiver on the compressed .tar.gz file, with command line arguments for the RabbitMQ parameters.</p>
<pre><code>graccunarchiver &lt;rabbitmq_url&gt; gracc.osg.raw gracc-2017-04-04.tar.gz
</code></pre>
</li>
<li>
<p>After restoring the raw jobs and transfers, it may be necessary to re-summarize the restored time-period with the <code>graccsummarizer</code> tool.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the backup tar.gz file was created during a crash of the agent or system, it's possible that the tar.gz end may be corrupted and you may see CRC or other errors.  The vast majority of the records are fine, but the last few may be corrupted and un-retrievable.</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../ops/services/" class="btn btn-neutral float-right" title="GRACE Operations">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../install-grace-db/" class="btn btn-neutral" title="GRACE Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Open Science Grid</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/gracc" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../install-grace-db/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../ops/services/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
