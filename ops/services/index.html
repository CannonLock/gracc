



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.5">
    
    
      
        <title>Operations - GRACC Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.bcabdff3.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="GRACC Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                GRACC Documentation
              </span>
              <span class="md-header-nav__topic">
                Operations
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/opensciencegrid/gracc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    GRACC Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/opensciencegrid/gracc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/standard/" title="Standard Interfaces" class="md-nav__link">
      Standard Interfaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/grafana/" title="Custom Grafana" class="md-nav__link">
      Custom Grafana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/direct/" title="Direct Queries" class="md-nav__link">
      Direct Queries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Development Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Development Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-docs/agent-arch/" title="Agent Architecture" class="md-nav__link">
      Agent Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-docs/message-queues/" title="Message Queues" class="md-nav__link">
      Message Queues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-docs/raw-records/" title="Raw Records" class="md-nav__link">
      Raw Records
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Operator Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Operator Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-docs/install-grace-db/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-docs/backups/" title="Backup Documentation" class="md-nav__link">
      Backup Documentation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Operations
      </label>
    
    <a href="./" title="Operations" class="md-nav__link md-nav__link--active">
      Operations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#external" title="External" class="md-nav__link">
    External
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq" title="RabbitMQ" class="md-nav__link">
    RabbitMQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#head-node-gratiav2-1" title="Head Node (gratiav2-1)" class="md-nav__link">
    Head Node (gratiav2-1)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elasticsearch-ingest-node" title="Elasticsearch (ingest node)" class="md-nav__link">
    Elasticsearch (ingest node)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-query-node" title="Elasticsearch (query node)" class="md-nav__link">
    Elasticsearch (query node)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-collectors-and-stash-agents" title="GRACC Collectors and Stash agents" class="md-nav__link">
    GRACC Collectors and Stash agents
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#streams" title="Streams" class="md-nav__link">
    Streams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-request-agent" title="GRACC Request Agent" class="md-nav__link">
    GRACC Request Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-summary-agent" title="GRACC Summary Agent" class="md-nav__link">
    GRACC Summary Agent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apel-reporting" title="APEL reporting" class="md-nav__link">
    APEL reporting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-gracc-apel-in-systemd" title="Configuring GRACC-APEL in systemd" class="md-nav__link">
    Configuring GRACC-APEL in systemd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana" title="Grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kibana" title="Kibana" class="md-nav__link">
    Kibana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus" title="Prometheus" class="md-nav__link">
    Prometheus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-exporters" title="Prometheus Exporters" class="md-nav__link">
    Prometheus Exporters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq-exporter" title="RabbitMQ Exporter" class="md-nav__link">
    RabbitMQ Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-exporter" title="Node Exporter" class="md-nav__link">
    Node Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphite-exporter" title="Graphite Exporter" class="md-nav__link">
    Graphite Exporter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" title="Nginx" class="md-nav__link">
    Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker" class="md-nav__link">
    Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#portainer" title="Portainer" class="md-nav__link">
    Portainer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-nodes-gratiav2-2-though-5" title="Data Nodes (gratiav2-2 though -5)" class="md-nav__link">
    Data Nodes (gratiav2-2 though -5)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elasticsearch" title="Elasticsearch" class="md-nav__link">
    Elasticsearch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-exporters_1" title="Prometheus Exporters" class="md-nav__link">
    Prometheus Exporters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-exporter_1" title="Node Exporter" class="md-nav__link">
    Node Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-exporter" title="Elasticsearch Exporter" class="md-nav__link">
    Elasticsearch Exporter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshoot/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Content Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Content Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../content/corrections/" title="Corrections" class="md-nav__link">
      Corrections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#external" title="External" class="md-nav__link">
    External
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq" title="RabbitMQ" class="md-nav__link">
    RabbitMQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#head-node-gratiav2-1" title="Head Node (gratiav2-1)" class="md-nav__link">
    Head Node (gratiav2-1)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elasticsearch-ingest-node" title="Elasticsearch (ingest node)" class="md-nav__link">
    Elasticsearch (ingest node)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-query-node" title="Elasticsearch (query node)" class="md-nav__link">
    Elasticsearch (query node)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-collectors-and-stash-agents" title="GRACC Collectors and Stash agents" class="md-nav__link">
    GRACC Collectors and Stash agents
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#streams" title="Streams" class="md-nav__link">
    Streams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-request-agent" title="GRACC Request Agent" class="md-nav__link">
    GRACC Request Agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gracc-summary-agent" title="GRACC Summary Agent" class="md-nav__link">
    GRACC Summary Agent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apel-reporting" title="APEL reporting" class="md-nav__link">
    APEL reporting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-gracc-apel-in-systemd" title="Configuring GRACC-APEL in systemd" class="md-nav__link">
    Configuring GRACC-APEL in systemd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana" title="Grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kibana" title="Kibana" class="md-nav__link">
    Kibana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus" title="Prometheus" class="md-nav__link">
    Prometheus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-exporters" title="Prometheus Exporters" class="md-nav__link">
    Prometheus Exporters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rabbitmq-exporter" title="RabbitMQ Exporter" class="md-nav__link">
    RabbitMQ Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-exporter" title="Node Exporter" class="md-nav__link">
    Node Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphite-exporter" title="Graphite Exporter" class="md-nav__link">
    Graphite Exporter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" title="Nginx" class="md-nav__link">
    Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker" class="md-nav__link">
    Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#portainer" title="Portainer" class="md-nav__link">
    Portainer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-nodes-gratiav2-2-though-5" title="Data Nodes (gratiav2-2 though -5)" class="md-nav__link">
    Data Nodes (gratiav2-2 though -5)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elasticsearch" title="Elasticsearch" class="md-nav__link">
    Elasticsearch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-exporters_1" title="Prometheus Exporters" class="md-nav__link">
    Prometheus Exporters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-exporter_1" title="Node Exporter" class="md-nav__link">
    Node Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch-exporter" title="Elasticsearch Exporter" class="md-nav__link">
    Elasticsearch Exporter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/opensciencegrid/gracc/edit/master/docs/ops/services.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="gracc-services">GRACC Services</h1>
<p>These are the services the comprise the GRACC system, and details on
where and how they are currently deployed on GRACE. </p>
<ul>
<li>Items marked with !! should be redesigned for production.</li>
<li>Items marked with ?? should be evaluated for removal.
  (note: FIFE services will be moved to another Elasticsearch cluster "soon")</li>
</ul>
<h2 id="external">External</h2>
<h3 id="rabbitmq">RabbitMQ</h3>
<ul>
<li>Running at the GOC</li>
<li>ITB: event-itb.grid.iu.edu:5672, :5671 (TLS), :15671 (HTTPS admin)</li>
<li>Production: event.grid.iu.edu:5672, :5671 (TLS), :15671 (HTTPS admin)</li>
</ul>
<h2 id="head-node-gratiav2-1">Head Node (<code>gratiav2-1</code>)</h2>
<p>Openstack limits external access to ssh (:22) and http (:80 and :443).</p>
<h3 id="elasticsearch-ingest-node">Elasticsearch (ingest node)</h3>
<ul>
<li>Installed from official elastic repository</li>
<li>Config in /etc/elasticsearch</li>
<li>Running under systemd: <code>elasticsearch.service</code></li>
<li>Listening at:<ul>
<li>http://0.0.0.0:9200 and :9300</li>
<li>https://gracc.opensciencegrid.org/e/</li>
<li>?? https://fifemon-es.fnal.gov</li>
</ul>
</li>
<li>External access requires certificate from GRACC private CA<ul>
<li>Certs and keys in <code>/etc/nginx/certs</code></li>
<li>Run <code>make_cert COMMON_NAME</code> to generate and sign a new certificate</li>
</ul>
</li>
<li>nginx allows very limited read-only access through public endpoints</li>
</ul>
<h3 id="elasticsearch-query-node">Elasticsearch (query node)</h3>
<ul>
<li>!! Manual copy of ingest node (<code>s/elasticsearch/elasticsearch-ro/</code>)</li>
<li>Config in <code>/etc/elasticsearch-ro</code></li>
<li>Running under systemd: <code>elasticsearch-ro.service</code></li>
<li>Listening at:</li>
<li>http://localhost:9201</li>
<li>https://gracc.opensciencegrid.org/q/</li>
<li>Includes <code>readonlyrest</code> plugin to allow limited unauthenticated read-only access 
  from Kibana, Grafana, and to public queries. Configured in <code>elasticsearch.yml</code>
  https://readonlyrest.com</li>
</ul>
<h3 id="gracc-collectors-and-stash-agents">GRACC Collectors and Stash agents</h3>
<p>GRACC Collectors (<code>gracc-collector</code>) accept records in formats provided by Gratia 
probes and collectors, transform them into GRACC JSON documents, and send them to 
the appropriate RabbitMQ exchange, which by convention is <code>gracc.$STREAM.raw</code>.</p>
<p>Raw Stash agents (<code>gracc-stash-raw</code>) create a queue in RabbitMQ that is bound the the appropriate
raw exchange, do minor manipulations to the documents (add checksum, calculate derived fields),
and index the documents into elasticsearch (<code>gracc.$STREAM.raw$N-$YYYY.$MM</code>), where <code>$N</code> is a 
monotonic schema version number. !! A cron job, currently running under kretzke, generates aliases 
in Elasticsearch each month from <code>gracc.$STREAM.raw$N-$YYYY.$MM</code> to <code>gracc.$STREAM.raw-$YYYY.$MM</code>.</p>
<p>Summary Stash agents (<code>gracc-stash-summary</code>) create a queue in RabbitMQ that is bound the the appropriate
summary exchange, do minor manipulations to the documents (add checksum, calculate derived fields),
and index the documents into elasticsearch (<code>gracc.$STREAM.summary$N-$YYYY</code>), where <code>$N</code> is a 
monotonic schema version number. !! Aliases are manually cretated in Elasticsearch from 
<code>gracc.$STREAM.summary$N-$YYYY</code> to <code>gracc.$STREAM.summary</code> (note just <em>one</em> alias for all years).</p>
<ul>
<li>Running under docker, via docker-compose</li>
<li>Config in <code>/etc/gracc/docker/$STREAM</code></li>
<li>Within each directory is:<ul>
<li><code>docker-compose.yml</code> - defines services for the stream</li>
<li><code>.env</code> - common environment variables for the stream's services</li>
</ul>
</li>
</ul>
<h4 id="streams">Streams</h4>
<ul>
<li><code>gracc.osg</code> - "main" job stream<ul>
<li>Collector listening at:<ul>
<li>http://localhost:8180</li>
<li>http://gracc.opensciencegrid.org/gracc/osg</li>
</ul>
</li>
</ul>
</li>
<li><code>gracc.osg-itb</code> - ITB test stream<ul>
<li>Collector listening at:<ul>
<li>http://localhost:8181</li>
<li>http://gracc.opensciencegrid.org/gracc/osg-itb</li>
</ul>
</li>
</ul>
</li>
<li><code>gracc.osg-transfer</code> - transfers stream<ul>
<li>Collector listening at:<ul>
<li>http://localhost:8182</li>
<li>http://gracc.opensciencegrid.org/gracc/osg-transfer</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="gracc-request-agent">GRACC Request Agent</h3>
<p>The Request agent (<code>gracc-request</code>) listens on a RabbitMQ exchange (<code>gracc.$STREAM.requests</code>) 
for requests for "replay" or "summarization" of raw records for a given time period. The request 
includes a RabbitMQ exhchange the records should be sent to.</p>
<ul>
<li>!! Installed from copr (https://copr.fedorainfracloud.org/coprs/djw8605/GRACC/)</li>
<li>Running under systemd: <code>graccreq.service</code></li>
<li>Config in <code>/etc/graccreq/config.d/gracc-request.toml</code></li>
</ul>
<h3 id="gracc-summary-agent">GRACC Summary Agent</h3>
<p>The Summary agent (<code>gracc-summary</code>) periodically requests summarizations, and has a CLI to manually
summarize periods.</p>
<ul>
<li>!! Installed from copr (https://copr.fedorainfracloud.org/coprs/djw8605/GRACC/)</li>
<li>Running under systemd: </li>
<li>Every 15 minutes, resummarize the last 7 days: <code>graccsumperiodic.service</code> and <code>graccsumperiodic.timer</code></li>
<li>Every 24 hours, resummarize the last 365 days: <code>graccsumperiodicyearly.service</code> and <code>graccsumperiodicyearly.timer</code></li>
<li>Config in <code>/etc/graccsum/config.d/gracc-summary.toml</code></li>
</ul>
<h4 id="apel-reporting">APEL reporting</h4>
<ul>
<li>Source at <a href="https://hub.docker.com/r/opensciencegrid/gracc-apel/">OSG docker</a> <ul>
<li><code>docker {pull, run} opensciencegrid/gracc-apel</code></li>
</ul>
</li>
<li>Running under systemd: <code>gracc-apel.service</code> and <code>gracc-apel.timer</code></li>
<li>Registered service certificate with <a href="../apel-admins@stfc.ac.uk">APEL admins</a> needed <ul>
<li>in docker we use:
<code>$ openssl x509 -in /etc/grid-security/apel/apelcert.pem -noout -subject
    subject= /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=apel/hcc-grace.unl.edu</code></li>
<li>SELinux prevents inheritance of certificates, so this must be set on docker master node: <code>chcon -Rt svirt_sandbox_file_t /etc/grid-security/apel/</code></li>
</ul>
</li>
</ul>
<h5 id="configuring-gracc-apel-in-systemd">Configuring GRACC-APEL in systemd</h5>
<ul>
<li><code>gracc-apel.service</code> configure, enable, start, test</li>
</ul>
<pre><code>    $ cat /lib/systemd/system/gracc-apel.service 
      [Unit]
      Description=GRACC APEL reporting Docker container

      [Service]
      Type=oneshot
      ExecStart=/bin/docker run -v /etc/grid-security/apel/apelcert.pem:/etc/grid-security/apel/apelcert.pem -v /etc/grid-security/apel/apelkey.pem:/etc/grid-security/apel/apelkey.pem opensciencegrid/gracc-apel

    $ systemctl enabled gracc-apel.service
    $ systemctl start gracc-apel.service
    $ systemctl status gracc-apel.service
</code></pre>

<p>To run periodically:
* <code>gracc-apel.timer</code> configure, enable, start</p>
<pre><code>    $ cat /lib/systemd/system/gracc-apel.timer 
    [Unit]
    Description=Run GRACC-to-APEL reporting script

    [Timer]
    # Explicitly declare service that this timer is responsible for
    Unit=gracc-apel.service
    # Runs 'gracc-apel' relative to when the *timer-unit* has been activated
    OnActiveSec=1hour
    # Runs 'gracc-apel' relative to when *service-unit* was last deactivated
    OnUnitInactiveSec=1hour

    # Randomize runtime by a small amount each run.
    RandomizedDelaySec=2min

    [Install]
    WantedBy=timers.target
    $ systemctl enabled gracc-apel.timer
    $ systemctl start gracc-apel.timer
    $ systemctl status gracc-apel.timer
</code></pre>

<ul>
<li>To check if <code>gracc-apel.timer</code> runs:</li>
</ul>
<pre><code>    $ systemctl list-timers *apel*
    NEXT                         LEFT       LAST                         PASSED    UNIT             ACTIVATES
    Mon 2017-05-22 17:48:37 CDT  21min left Mon 2017-05-22 16:46:40 CDT  40min ago gracc-apel.timer gracc-apel.service
</code></pre>

<h3 id="grafana">Grafana</h3>
<ul>
<li>Installed from official Grafana yum repo</li>
<li>Running under systemd: <code>grafana-server.service</code></li>
<li>Config in <code>/etc/grafana</code></li>
<li>Data in <code>/var/lib/grafana</code></li>
<li>Listening at:</li>
<li>http://localhost:3000</li>
<li>https://gracc.opensciencegrid.org/</li>
</ul>
<h3 id="kibana">Kibana</h3>
<ul>
<li>Installed from official Elasticsearch yum repo</li>
<li>Running under systemd: <code>kibana.service</code></li>
<li>Config in /etc/kibana</li>
<li>Listening at:</li>
<li>http://localhost:5601</li>
<li>https://gracc.opensciencegrid.org/kibana/</li>
<li><code>readonlyrest</code> Elasticsearch plugin controls access, write actions require authentication
  with basic auth, configured in <code>/etc/elasticsearch-ro/elasticsearch.yml</code>.</li>
</ul>
<h3 id="prometheus">Prometheus</h3>
<p>Prometheus is used for monitoring the nodes and services.</p>
<ul>
<li>!! Installed in <code>/opt/prometheus</code></li>
<li>Config in <code>/etc/prometheus</code></li>
<li>Data in <code>/data/prometheus</code></li>
<li>Running under systemd: <code>prometheus.service</code></li>
<li>Listening at:</li>
<li>http://localhost:9090</li>
<li>https://gracc.opensciencegrid.org/prometheus </li>
<li>!! external access requires basic auth, <code>/etc/nginx/conf.d/kibana.htpasswd</code></li>
<li>limited unauthenticated access to query endpoint</li>
</ul>
<h3 id="prometheus-exporters">Prometheus Exporters</h3>
<p>Prometheus exporters collect data from services and present them for collection by Prometheus.</p>
<h4 id="rabbitmq-exporter">RabbitMQ Exporter</h4>
<ul>
<li>!! manually run under docker (to be moved to docker-compose)</li>
<li>configuration via env var<ul>
<li>RABBIT_URL=https://event-itb.grid.iu.edu:15671</li>
<li>RABBIT_USER=$USER</li>
<li>RABBIT_PASSWORD=$PASSWORD</li>
</ul>
</li>
<li>Listening at http://localhost:9111</li>
</ul>
<h4 id="node-exporter">Node Exporter</h4>
<ul>
<li>Installed at <code>/opt/prometheus</code></li>
<li>Run with systemd: <code>prometheus-node-exporter.service</code></li>
<li>Listening at http://0.0.0.0:9100</li>
</ul>
<h4 id="graphite-exporter">Graphite Exporter</h4>
<p>The Graphite exporter accepts time-series data in graphite format and exposes it for 
collection by prometheus.</p>
<ul>
<li>Running under docker</li>
<li>Listening at:<ul>
<li>http://0.0.0.0:9100 (publish to prometheus)</li>
<li>https://0.0.0.0:2003 (collect from graphite)</li>
</ul>
</li>
</ul>
<h3 id="nginx">Nginx</h3>
<p>All public services are proxied through nginx.</p>
<ul>
<li>Installed from EPEL</li>
<li>Primary config in <code>/etc/nginx/conf.d/default.conf</code></li>
<li>Running under systemd: <code>nginx.service</code></li>
<li>Listening at:</li>
<li>http://0.0.0.0:80</li>
<li>http://0.0.0.0:443</li>
<li>http://gracc.opensciencegrid.org</li>
<li>https://gracc.opensciencegrid.org</li>
</ul>
<h3 id="docker">Docker</h3>
<ul>
<li>Running under systemd: <code>docker.service</code></li>
<li>Extra config in <code>/etc/systemd/system/docker.service.d</code></li>
<li>Container logs sent to journald; e.g. <code>sudo journalctl CONTAINER_NAME=graccosg_gracc-collector_1</code></li>
</ul>
<h4 id="portainer">Portainer</h4>
<p>Portainer is a web-based utility for monitoring and managing containers.</p>
<ul>
<li>running under docker</li>
<li>listening on http://0.0.0.0:9000</li>
<li>!! not proxied through nginx, need to tunnel, e.g. <code>ssh -L 9000:localhost:9000 gracc.opensciencegrid.org</code></li>
</ul>
<h2 id="data-nodes-gratiav2-2-though-5">Data Nodes (<code>gratiav2-2</code> though <code>-5</code>)</h2>
<p>Ansible is set up on the head node to perform operations across all data 
nodes, e.g. <code>sudo ansible elasticsearch -a 'uptime'</code>. Configuration in
<code>/etc/ansible</code>.</p>
<h3 id="elasticsearch">Elasticsearch</h3>
<ul>
<li>Installed from official elastic repository</li>
<li>Config in <code>/etc/elasticsearch</code></li>
<li>Data in  <code>/data/elasticsearch</code> and <code>/data2/elasticsearch</code></li>
<li>Listening at http://0.0.0.0:9200 and :9300</li>
</ul>
<h3 id="prometheus-exporters_1">Prometheus Exporters</h3>
<h4 id="node-exporter_1">Node Exporter</h4>
<ul>
<li>Installed at <code>/opt/prometheus</code></li>
<li>Run with systemd: <code>prometheus-elasticsearch-exporter.service</code></li>
<li>Listening at http://0.0.0.0:9100</li>
</ul>
<h4 id="elasticsearch-exporter">Elasticsearch Exporter</h4>
<ul>
<li>Installed at <code>/opt/prometheus</code></li>
<li>Run with systemd: <code>prometheus-node-exporter.service</code></li>
<li>Listening at http://0.0.0.0:9108</li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../dev-docs/backups/" title="Backup Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Backup Documentation
              </span>
            </div>
          </a>
        
        
          <a href="../troubleshoot/" title="Troubleshooting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Troubleshooting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Open Science Grid
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>